<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/head') %>
  </head>
  <body>
    <%- include('../partials/nav') %>

    <div class="container mb-3">

      <h2 class="mb-3">Board</h2>

      <table class="board-table table table-sm border-bottom">

        <thead class="thead-light">
          <tr>
            <th scope="col" class="numId">#</th> <!-- 1 -->
            <th scope="col">Title</th>
            <th scope="col" class="views">Views</th>  <!-- 2 -->
            <th scope="col" class="author">Author</th>
            <!-- tableÏùò theaderÏóê author Ìï≠Î™©ÏùÑ Ï∂îÍ∞ÄÌï©ÎãàÎã§. -->
            <th scope="col" class="date">Date</th>
          </tr>
        </thead>

        <tbody>
          <% if(posts == null || posts.length == 0){ %>
            <tr>
              <td colspan=5> There is no data to show :( </td>
            </tr>
          <% } %>
          <% posts.forEach(function(post) { %>
            <tr>
              <td class="numId"><%= post.numId %></td>
              <td>
          <!-- <a href="/posts/<%= post._id %><%= getPostQueryString() %>"><div class="ellipsis"><%= post.title %></div></a> -->
                <!--
                Í≤åÏãúÌåêÏóêÏÑú Í≤åÏãúÎ¨º Ï†úÎ™©ÏùÑ ÎàåÎü¨ show routeÏúºÎ°ú Í∞ÄÎäî Í≤ΩÏö∞ page, limit query
                stringÏùÑ Ï†ÑÎã¨Ìï¥ Ï§çÎãàÎã§. viewÏóêÏÑúÎäî res.localsÏùò Ìï≠Î™©Îì§ÏùÑ Î∞îÎ°ú ÏÇ¨Ïö©Ìï† Ïàò
                ÏûàÍ∏∞ÎïåÎ¨∏Ïóê res.locals.getPostQueryStringÍ∞Ä ÏïÑÎãàÎùº getPostQueryStringÎ°ú
                Ìò∏Ï∂úÌï©ÎãàÎã§.
                -->
                <a href="/posts/<%= post._id %><%= getPostQueryString() %>" class="title-container">
                  <!--
                  ellipsis(ÌÖçÏä§Ìä∏Í∞Ä ÎÑàÎ¨¥ Í∏∏ Í≤ΩÏö∞ Ìï¥Îãπ Î≤îÏúÑ Î∞ñÏùò ÌÖçÏä§Ìä∏Î•º '...'Î°ú ÌëúÏãúÌïòÎäî Í≤É)Î•º Íµ¨ÌòÑÌïòÍ∏∞
                  ÏúÑÌï¥ title-text, title-commentsÎì±Ïùò CSS classÎì§Ïù¥ Ï∂îÍ∞Ä ÎêòÏóàÏäµÎãàÎã§.
                  -->
                  <div data-search-highlight="title" class="title-ellipsis ellipsis float-left">
                    <span class="title-text"><%= post.title %></span>
                  </div>
                  <% if(post.commentCount){ %>
                    <small class="title-comments d-inline-block pl-2">(<%= post.commentCount %>)</small>
                  <% } %>
                  <!--
                  ÎåìÍ∏ÄÏùò ÏàòÎäî post routeÎ•º ÌÜµÌï¥ÏÑú Ïù¥ÎØ∏ post.commentCountÏóê Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏúºÎØÄÎ°ú Ïñ¥ÎñªÍ≤å Î≥¥Ïó¨Ï§ÑÏßÄÎßå Í≥†ÎØºÌïòÎ©¥Îê©ÎãàÎã§.
                  -->
                  <% if(post.attachment){ %>
                    <small class="title-attachment d-inline-block pl-2">üìÅ</small>
                  <% } %>
                </a>
              </td>
              <td class="views"><%= post.views %></td>
              <td class="author"> <!-- 2 -->
           <!-- <div class="ellipsis"><%= post.author ? post.author.username : "" %></div> -->
              <!-- tableÏùò tbodyÏóê author Ìï≠Î™©ÏùÑ Ï∂îÍ∞ÄÌïòÍ≥†
              authorÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ authorÏùò usernameÏùÑ ÌëúÏãúÌï©ÎãàÎã§. -->
                <a href="/posts<%= getPostQueryString(false, { searchType:'author!', searchText:post.author.username }) %>">
                  <div data-search-highlight="author" class="ellipsis"><%= post.author ? post.author.username : "" %></div>
                </a>
              <td class="date">
                <span data-date="<%= post.createdAt %>"></span>
<!--
PostÏùò indexÎ•º tableÎ°ú ÌëúÏãúÌï©ÎãàÎã§.
1. data-dateÍ∞Ä <span> elementÏóê ÏÇ¨Ïö©ÎêòÏóàÏäµÎãàÎã§.
public/js/script.jsÏóê ÏùòÌï¥ post.createdAt,
Ï¶â Í≤åÏãúÎ¨º ÏûëÏÑ±ÏãúÍ∞ÑÏù¥ ÎÖÑ-Ïõî-ÏùºÏùò ÌòïÌÉúÎ°ú Ï∂úÎ†•Îê©ÎãàÎã§.
-->
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <!-- ~ normal board
      <div>
        <a class="btn btn-primary" href="/posts/new">New</a>
      </div>
      <div>
        <% if(isAuthenticated){ %>
          <a class="btn btn-primary" href="/posts/new">New</a>
        <% } %>
      </div>
    -->
      <!--
index.ejsÏóêÏÑú new Î≤ÑÌäºÏùÄ Î°úÍ∑∏Ïù∏Îêú Í≤ΩÏö∞ÏóêÎßå Î≥¥Ïù¥Í≤å Îê©ÎãàÎã§.
Ï∞∏Í≥†Î°ú isAuthenticatedÌï®ÏàòÎäî Í≤åÏãúÌåê - Login Í∏∞Îä• Ï∂îÍ∞ÄÍ∞ïÏ¢åÏóêÏÑú
index.jsÏÜçÏóê ÎßåÎì§ÏóàÎçò Ìï®ÏàòÏûÖÎãàÎã§. req.localsÏóê Îì§Ïñ¥ÏûàÏñ¥ÏÑú
ejsÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.
      -->

      <div class="row mb-3">
        <div class="col-2">
          <!--
New Î≤ÑÌäºÏùÑ paginationÍ≥º Í∞ôÏùÄ Ï§ÑÏóê ÎÜìÍ∏∞ ÏúÑÌï¥ Bootstrap grid
(https://getbootstrap.com/docs/4.1/layout/grid) css (row, col-?)Î•º
ÏÇ¨Ïö©ÌïòÏòÄÏäµÎãàÎã§.
          -->
          <% if(isAuthenticated){ %>
           <a class="btn btn-primary" href="/posts/new<%= getPostQueryString() %>">New</a>
         <% } %>
       </div>
        <nav class="col-8">
          <%
            var offset = 2;
            var previousBtnEnabled = currentPage>1;
            var nextBtnEnabled = currentPage<maxPage;
          %>
          <!--
          paginationÏóê ÏÇ¨Ïö©Îê† Î≥ÄÏàòÎì§ÏûÖÎãàÎã§.
- offset: ÌòÑÏû¨ÌéòÏù¥ÏßÄ Ï¢åÏö∞Î°ú Î™áÍ∞úÏùò ÌéòÏù¥ÏßÄÎì§ÏùÑ Î≥¥Ïó¨Ï§ÑÏßÄÎ•º Ï†ïÌïòÎäî Î≥ÄÏàòÏûÖÎãàÎã§.
- previousBtnEnabled: Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäºÏùÄ ÌòÑÏû¨ÌéòÏù¥ÏßÄÍ∞Ä 1Î≥¥Îã§ ÌÅ∞ Í≤ΩÏö∞ÏóêÎßå
ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
- nextBtnEnabled: Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäºÏùÄ ÌòÑÏû¨ÌéòÏù¥ÏßÄÍ∞Ä ÎßàÏßÄÎßâÌéòÏù¥ÏßÄ(maxPage)Î≥¥Îã§
ÏûëÏùÄ Í≤ΩÏö∞ÏóêÎßå ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
          -->
          <ul class="pagination pagination-sm justify-content-center align-items-center h-100 mb-0">
            <li class="page-item <%= previousBtnEnabled?'':'disabled' %>">
              <a class="page-link" href="/posts<%= getPostQueryString(false, {page:currentPage-1}) %>" <%= previousBtnEnabled?'':'tabindex=-1' %>>¬´</a>
            </li>
            <% for(i=1;i<=maxPage;i++){ %>
              <% if(i==1 || i==maxPage || (i>=currentPage-offset && i<=currentPage+offset)){ %>
                <li class="page-item <%= currentPage==i?'active':'' %>"><a class="page-link" href="/posts<%= getPostQueryString(false, {page:i}) %>"> <%= i %> </a></li>
              <% } else if(i==2 || i==maxPage-1){ %>
                <li><a class="page-link">...</a></li>
              <% } %>
            <% } %>
            <li class="page-item <%= nextBtnEnabled?'':'disabled' %>">
              <a class="page-link" href="/posts<%= getPostQueryString(false, {page:currentPage+1}) %>" <%= nextBtnEnabled?'':'tabindex=-1' %>>¬ª</a>
            </li>
          </ul>
        </nav>
      </div>
      <form action="/posts" method="get" class="post-index-tool">
        <!--
Í≤ÄÏÉâÏ∞ΩÏùò ÏÇ¨Ïù¥Ï¶àÎ•º Ï°∞Ï†àÌïòÍ∏∞ ÏúÑÌï¥ post-index-tool CSS classÎ•º Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.
        -->
        <div class="form-row">
          <div class="form-group col-3">
            <label>Show</label>
            <select name="limit" class="custom-select" onchange="this.parentElement.parentElement.parentElement.submit()">
              <option value="5" <%= limit==5?'selected':'' %>>5 posts</option>
              <option value="10" <%= limit==10?'selected':'' %>>10 posts</option>
              <option value="20" <%= limit==20?'selected':'' %>>20 posts</option>
            </select>
          </div>

          <div class="form-group col-9">
            <label>Search</label>
            <div class="input-group">
              <select name="searchType" class="custom-select">
                <option value="title,body" <%= searchType=='title,body'?'selected':'' %>>Title, Body</option>
                <option value="title" <%= searchType=='title'?'selected':'' %>>Title</option>
                <option value="body" <%= searchType=='body'?'selected':'' %>>Body</option>
                <option value="author" <%= searchType=='author'?'selected':'' %>>Author</option>
              </select>
              <input minLength="3" type="text" name="searchText" value="<%= searchText %>">
              <div class="input-group-append">
                <button class="btn btn-outline-primary" type="submit">Search</button>
              </div>
            </div>
          </div>
          <!--
Í≤ÄÏÉâ formÏûÖÎãàÎã§. BootstrapÏùò input group(https://getbootstrap.com/docs/4.1/components/input-group)ÏùÑ
ÏÇ¨Ïö©ÌïòÏó¨ Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• formÍ≥º search Î≤ÑÌäºÏùÑ Ïù¥Ïñ¥Î∂ôÏòÄÏäµÎãàÎã§.
          -->

        </div>
      </form>

    </div>
  </body>
</html>
¬© 2021 GitHub, Inc.
